<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><title> Crypto-JS 介绍以及一个常见的坑 · xiaopc</title><meta name="description" content="Crypto-JS 介绍以及一个常见的坑 - xiaopc"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://xiaopc.org/atom.xml" title="xiaopc"><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="xiaopc" type="application/atom+xml">
</head><body><div class="wrap"><header><a class="logo-link" href="/"><img src="/logo.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">home</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">archives</a></li><li class="nav-list-item"><a class="nav-list-link" href="/links/" target="_self">links</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://xpc.im/" target="_blank">about</a></li><li class="nav-list-item"><a class="nav-list-link" href="/blog-en/" target="_self">en</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Crypto-JS 介绍以及一个常见的坑</h1><div class="post-info">2016年7月26日 · <a href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></div><div class="post-content"><h2 id="概述">概述</h2>
<p>在无法使用 HTTPS 时，或需要增加前端安全时，用 JS 加密是个可行的方法。Crypto-JS 支持 MD5/SHA-1/SHA-2/SHA-3/HMAC/PBKDF2 等 Hash，以及 AES/DES/Triple DES/Rabbit/RC4/RC4Drop 等 Cipher，可自选 Block Modes 和 Padding。可单独加载某一种模式，有很强的组合性。</p>
<p>地址：<a target="_blank" rel="noopener" href="https://code.google.com/archive/p/crypto-js/">https://code.google.com/archive/p/crypto-js/</a> &amp;&amp; <a target="_blank" rel="noopener" href="https://github.com/brix/crypto-js">https://github.com/brix/crypto-js</a></p>
<span id="more"></span>
<h2 id="md5">MD5</h2>
<p>可单独引用 md5.js 。 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">CryptoJS</span>.<span class="title class_">MD5</span>(<span class="string">&quot;test&quot;</span>);</span><br></pre></td></tr></table></figure></p>
<h2 id="pbkdf2">PBKDF2</h2>
<p>可单独引用 pbkdf2.js 。 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 官方示例</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> salt = <span class="title class_">CryptoJS</span>.<span class="property">lib</span>.<span class="property">WordArray</span>.<span class="title function_">random</span>(<span class="number">128</span>/<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> key128Bits = <span class="title class_">CryptoJS</span>.<span class="title class_">PBKDF2</span>(str, salt, &#123; <span class="attr">keySize</span>: <span class="number">128</span>/<span class="number">32</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> key256Bits = <span class="title class_">CryptoJS</span>.<span class="title class_">PBKDF2</span>(str, salt, &#123; <span class="attr">keySize</span>: <span class="number">256</span>/<span class="number">32</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> key512Bits = <span class="title class_">CryptoJS</span>.<span class="title class_">PBKDF2</span>(str, salt, &#123; <span class="attr">keySize</span>: <span class="number">512</span>/<span class="number">32</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> key512Bits1000Iterations = <span class="title class_">CryptoJS</span>.<span class="title class_">PBKDF2</span>(<span class="string">&quot;Secret Passphrase&quot;</span>, salt, &#123;</span><br><span class="line"><span class="attr">keySize</span>: <span class="number">512</span>/<span class="number">32</span>,</span><br><span class="line"><span class="attr">iterations</span>: <span class="number">1000</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="aes">AES</h2>
<p>默认是 AES-CBC-Pkcs5(Pkcs7)（其他套件可单独引用），密钥长度随输入的密码长度自动确定（如果使用<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Passphrase">密码短语</a>则使用 256 位）。</p>
<p>加密：（文题所说的坑在这） <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;123456&#x27;</span>; <span class="comment">// 加密内容</span></span><br><span class="line"><span class="keyword">var</span> key = <span class="string">&#x27;0123456789abcdef&#x27;</span>; <span class="comment">// 密钥</span></span><br><span class="line"><span class="keyword">var</span> iv = <span class="string">&#x27;0123456789abcdef&#x27;</span>; <span class="comment">// 初始向量，不设置会随机生成(当然也就无法解密了)</span></span><br><span class="line"></span><br><span class="line">key = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(key); <span class="comment">// **注意！如果引用了 jQuery 则需要加 &quot;toString()&quot;**</span></span><br><span class="line">iv = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(iv); <span class="comment">// **同上，详见 [2]**</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> encrypted = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">encrypt</span>(str, key, &#123;</span><br><span class="line"> <span class="attr">iv</span>: iv,</span><br><span class="line"> <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line"> <span class="attr">padding</span>: <span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// **encrypt()返回的是一个对象！需要：**</span></span><br><span class="line">encrypted = encrypted.<span class="title function_">toString</span>();</span><br></pre></td></tr></table></figure></p>
<p>解密： <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> decrypted = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">decrypt</span>(encrypted, key, &#123;</span><br><span class="line"> <span class="attr">iv</span>: iv,</span><br><span class="line"> <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line"> <span class="attr">padding</span>: <span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换为 utf8 字符串</span></span><br><span class="line">decrypted = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">stringify</span>(decrypted);</span><br></pre></td></tr></table></figure></p>
<h2 id="其他-cipher">其他 Cipher</h2>
<p>基本上相同，只是 Rabbit 和 RC4 不支持定义 mode 和 padding。</p>
<hr />
<p>本文参考了：</p>
<p>[1] JavaScript Crypto-JS 使用手册 <a target="_blank" rel="noopener" href="https://blog.zhengxianjun.com/2015/05/javascript-crypto-js/">https://blog.zhengxianjun.com/2015/05/javascript-crypto-js/</a></p>
<p>[2] <a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/35529804/using-crypto-js-to-encrypt-password-and-send-form-via-ajax-and-decrypt-in-java">http://stackoverflow.com/questions/35529804/using-crypto-js-to-encrypt-password-and-send-form-via-ajax-and-decrypt-in-java</a></p>
</div><div class="post-footer"><p class="license">本文以「<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-sa/4.0">知识共享 署名—相同方式共享（CC BY-SA 4.0）</a>」发布。<br><br>
允许复制、转贴、演绎本文，<br>
惟需注明本文地址，<br>
并遵循相同许可协议。<br></p><div class="like"><img class="like-qrcode" src="/wechat_like.png" alt="like qrcode"><img class="avatar" src="/avatar.jpg"></div></div></article></div></main><footer><div class="paginator"><a class="prev" href="/2016/08/04/textarea-%E9%AB%98%E5%BA%A6%E8%87%AA%E9%80%82%E5%BA%94%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/">上一篇</a><a class="next" href="/2016/07/22/%E8%BD%AC-getchar-%E5%92%8C-eof-%E6%80%BB%E7%BB%93/">下一篇</a></div><div class="copyright"><p>&copy; 2023 <a href="https://xiaopc.org">xiaopc</a>, <a href="https://hexo.io/" target="_blank">hexo</a> & <a href="https://github.com/xiaopc/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdnjs.loli.net/ajax/libs/mathjax/2.7.2-rc/MathJax.js?config=TeX-AMS-MML_HTMLorMML" crossorigin="anonymous"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-KNHBVTCZSN"></script><script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', "G-KNHBVTCZSN");</script></body></html>